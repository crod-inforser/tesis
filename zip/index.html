<!DOCTYPE html>
<html>

<head>
    <title>Enviar petición POST con JSON y conectarse a un socket</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.0/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.0.4/dist/pako.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuidv4.min.js"></script>

</head>

<body>
    <p id="connection-status">Conectando con el servidor de Socket.io...</p>
    <button id="my-button">Enviar petición POST y conectar a socket</button>
    <div id="messages"></div>
    <script>
        const room = uuidv4();
        // Función para enviar una petición POST al servidor
        function sendPostRequest() {

            // Datos del cuerpo de la petición
            const body = JSON.stringify({
                url: "https://archive.robocup.info/Soccer/Simulation/2D/logs/RoboCup/2021/Round1/GroupF/20210624201353-Oxsy_2-vs-CYRUS_4.rcg.gz",
                room
            });

            // Configuración de la petición
            const options = {
                method: 'POST',
                body,
                headers: {
                    'Content-Type': 'application/json'
                }
            };

            // Enviar la petición
            fetch('http://localhost:3000/api/convert/url', options);
            socket.emit('joinRoom', room);
        }

        // Conectar al socket y escuchar el evento "data"
        const socket = io('http://localhost:3000');

        socket.on('data', (data) => {
            const messages = document.querySelector('#messages');
            const plainData = pako.inflate(data, { to: 'string' });
            console.log(`Received data: ${plainData}`);
            messages.innerHTML += `<p>${plainData}</p>`;
        });
        const connectionStatus = document.getElementById("connection-status");

        // Escuchamos el evento "connect"
        socket.on("connect", () => {
            connectionStatus.textContent = "Conectado al servidor de Socket.io";
        });

        // Escuchamos el evento "disconnect"
        socket.on("disconnect", () => {
            connectionStatus.textContent = "Desconectado del servidor de Socket.io";
        });

        // Asociar la función al botón
        const button = document.querySelector('#my-button');
        button.addEventListener('click', sendPostRequest);
    </script>
</body>

</html>